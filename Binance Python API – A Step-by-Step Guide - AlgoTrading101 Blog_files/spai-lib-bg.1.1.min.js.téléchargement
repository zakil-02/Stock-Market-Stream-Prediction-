const SPAI_VJS="1.1.17";function spaiCalculateBgClipResize(e,t,i,r){var a=getComputedStyle(e);if(a.backgroundRepeat.indexOf("round")>=0)throw"Unsupported background-repeat: round";var s=e.offsetWidth,o=(e.offsetHeight,a.backgroundImage);if("none"===o&&(o=e.style.backgroundImage),!o.match(/url\s*\(/))return[];for(var n=0,l={};n<o.length;n++){var c=o.match(/\w*-gradient\s*\((?:[^\(\)]+|\([^\(\)]+\))*\)|none|initial|inherit|url\s*\(['"]?(.+?)['"]?\)/);if(null==c)break;if("url"===c[0].substr(0,3)){var d="function"==typeof t.getUrlData?t.getUrlData(c[1]):t.parsePseudoSrc(c[1]),h=void 0===d.originalWidth?d.origWidth:d.originalWidth,g=void 0===d.originalHeight?d.origHeight:d.originalHeight;if(!1===h||!1===g||1==h||1==g)l[c[1]]={width:!(!s||!r&&"cover"!=y(a.backgroundSize,n)&&"contain"!=y(a.backgroundSize,n))&&s,height:!1,originalUrl:d.src};else{var p={width:0,height:0};if(p.originalUrl=d.src,void 0!==h&&(p.originalWidth=p.width=h,p.originalHeight=p.height=g),i)try{var u=f(n,e,p,a);p.width==p.originalWidth&&p.height==p.originalHeight&&(p.width=p.height=!1),0==u.clip.offsetX&&0==u.clip.offsetY&&u.clip.width==p.originalWidth&&u.clip.height==p.originalHeight&&Math.abs(p.originalHeight*u.viewport.width/u.viewport.height-p.originalWidth)<=2?(p.width=u.viewport.width,p.height=!1):(p.clip=u.clip,p.viewport=u.viewport,p.alterCss=u.alterCss)}catch(e){p.width=p.height=!1}else p.width=p.height=!1;l[c[1]]=p}o=o.substr(c.index+c[0].length)}else o=o.substr(c.index+c[0].length)}return l;function f(e,t,i,r){var a={clip:{width:i.width,height:i.height,offsetX:0,offsetY:0},viewport:{width:Math.min(t.offsetWidth,i.width),height:Math.min(t.offsetHeight,i.height)},alterCss:{}},s=function(e,t,i,r){var a=y(r.backgroundSize,e),s=m(e,t,r,"x"),o=m(e,t,r,"y"),n=i.width/i.height,l="fixed"===r.backgroundAttachment?n:s/o,c={src:i.src,width:i.width,height:i.height,scalex:1,scaley:1};switch(a){case"contain":case"cover":return"contain"===a&&l<=n||"cover"===a&&l>=n?(c.width=s,c.height=s/n):(c.height=o,c.width=o*n),c.scalex=c.scaley=c.width/i.width,c;case"auto, auto":case"auto":return c;default:var d=a.split(" "),h=!1;return"auto"!==d[0]&&(c.width=v(e,d[0],t,!1,"x"),c.scalex=c.width/i.width,h=!0),void 0!==d[1]?(c.height=v(e,d[1],t,!1,"y"),h||(c.width=i.width*c.height/i.height,c.scalex=c.width/i.width)):c.height=i.height*c.width/i.width,c.scaley=c.height/i.height,c}}(e,t,i,r);!function(e,t,i,r,a){var s=y(a.backgroundSize,e);if(r.offsetx=r.offsety=0,"contain"===s)return r;r.offsetx=k(e,t,r,a,"x"),r.offsety=k(e,t,r,a,"y")}(e,t,0,s,r);var o=function(e,t,i,r,a){if("fixed"==y(a.backgroundAttachment,e))return{x:0,y:0,width:screen.width,height:99999};var s=y(a.backgroundClip,e),o=v(e,a.paddingLeft,t,!1,"w"),n=v(e,a.paddingTop,t,!1,"h");return{x:"border-box"==s?0:v(e,a.borderLeftWidth,t,!1,"w")+("content-box"==s?o:0),y:"border-box"==s?0:v(e,a.borderTopWidth,t,!1,"w")+("content-box"==s?n:0),width:"border-box"==s?t.offsetWidth:t.clientWidth-("content-box"==s?o+v(e,a.paddingRight,t,!1,"w"):0),height:"border-box"==s?t.offsetHeight:t.clientHeight-("content-box"==s?n+v(e,a.paddingBottom,t,!1,"h"):0)}}(e,t,0,0,r),n=z(e,s=S(e,s,o),o);return a.clip.width=Math.round(n.width/s.scalex),a.clip.height=Math.round(n.height/s.scaley),a.clip.offsetX=n.width<s.width&&x(r,e,"x")||s.offsetx<n.x&&!x(r,e,"x")?Math.round(Math.max(0,(n.x-s.offsetx)/s.scalex)):0,a.clip.offsetY=n.height<s.height&&x(r,e,"y")||s.offsety<n.y&&!x(r,e,"y")?Math.round(Math.max(0,(n.y-s.offsety)/s.scaley)):0,a.viewport.width=Math.round(n.width/Math.max(1,s.scalex)),a.viewport.height=Math.round(n.height/Math.max(1,s.scaley)),a.alterCss=n.alterCss,a}function v(e,t,i,r,s){var o=function(e){var t=parseFloat(e),i=e.substr((""+t).length);return{val:t,type:i}}(t),n=o.val,l=o.type,c=!1===r?0:r[function(e){return"x"==e?"width":"height"}(s)];if("%"==l)return n=(m(e,i,a,s)-c)*n/100,c>0&&(n%=c),n;if("em"==l)return n*v(e,a.fontSize,i.parentElement,!1,s);if("rem"==l)return n*parseFloat(getComputedStyle(document.documentElement).fontSize);if("vw"==l)return n*window.innerWidth/100;if("vh"==l)return n*window.innerHeight/100;if("vmin"==l)return n*Math.min(window.innerWidth,window.innerHeight)/100;if("vmax"==l)return n*Math.max(window.innerWidth,window.innerHeight)/100;if("px"==l)return n;if("in"==l)return 96*n;if("pt"==l)return 4*n/3;if("pc"==l)return 16*n;if("mm"==l)return 3.7795275591*n;if("cm"==l)return 37.795275591*n;throw"Unsupported unit"}function m(e,t,i,r){var a=y(i.backgroundOrigin,e);return t[("border-box"==a?"offset":"client")+function(e){return"x"==e?"Width":"Height"}(r)]-("content-box"==a?v(e,i["padding"+b(r)],t,!1,r)+v(e,i["padding"+function(e){return"x"==e?"-right":"-bottom"}(r)],t,!1,r):0)}function b(e){return"x"==e?"-left":"-top"}function y(e,t){return void 0===e?e:(e=e.split(","))[Math.min(t,e.length-1)].trim()}function w(e,t,i){return(e=e.split(","))[t=Math.min(t,e.length)]=i,e.join(", ")}function x(e,t,i){return"repeat"==y(e.backgroundRepeat,t)||"repeat"==y(e["background-repeat-"+i],t)}function S(e,t,i){var r=t.offsetx,s=t.offsety;return t.isRepeatX=x(a,e,"x"),t.isRepeatY=x(a,e,"y"),t.isRepeatX&&(r%=t.width),t.isRepeatY&&(s%=t.height),r>=i.width&&(t.isRepeatX?r-=t.width:t.width=t.height=!1),s>=i.height&&(t.isRepeatY?s-=t.height:t.width=t.height=!1),t.offsetx=r,t.offsety=s,t}function z(e,t,i){var r=Math.max(t.offsetx,i.x),s=Math.max(t.offsety,i.y),o=Math.min(t.width+t.offsetx,i.width+i.x)-r,n=Math.min(t.height+t.offsety,i.height+i.y)-s,l={};t.isRepeatX&&(t.offsetx>0||t.offsetx+t.width<i.width)?o=t.width:null===y(a["background-position-x"],e).match(/^[0-9]+%$/)&&t.offsetx<i.x&&(l["background-position-x"]=w(a["background-position-x"],e,i.x>0?i.x+"px":"0%")),t.isRepeatY&&(t.offsety>0||t.offsety+t.height<i.height)?n=t.height:null===y(a["background-position-y"],e).match(/^[0-9]+%$/)&&t.offsety<i.y&&(l["background-position-y"]=w(a["background-position-y"],e,i.y>0?i.y+"px":"0%"));var c=y(a.backgroundSize,e);return"auto"!==c&&"100%"!==c&&"cover"!==c&&"contain"!==c&&(l["background-size"]=w(a.backgroundSize,e,"auto")),{x:r,y:s,width:o,height:n,alterCss:l}}function k(e,t,i,r,a){var s=y(r["background-position-"+a],e);return function(e,t,i,r){var a=y(i.backgroundOrigin,e);return("padding-box"==a||"content-box"==a?v(e,i["border"+b(r)+"-width"],t,!1,r):0)+("content-box"==a?v(e,i["padding"+b(r)],t,!1,r):0)}(e,t,r,a)+(0!==parseInt(s)?v(e,s,t,i,a):0)}}!function(){"use strict";class e{constructor(e,t){let i={root:null,rootMargin:t,threshold:0,classTarget:this};this.observer=new IntersectionObserver(e,i)}addToObserver(e){this.observer.observe(e)}removeFromObserver(e){this.observer.unobserve(e)}buildThresholdList(){let e=[];for(let t=1;t<=6;t++){let i=t/6;e.push(i)}return e}}function t(e,r){if(0===e.offsetWidth&&0===e.offsetHeight&&r)throw{type:"defer",cause:"invisible"};var a=window.getComputedStyle(e),s=a.width,o=a.height;if("0px"==s&&"A"!==e.nodeName)throw{type:"defer",cause:"width 0"};if("auto"===s)return t(e.parentElement);var n=parseFloat(s),l=parseFloat(o);if("%"==s.slice(-1)){if(null===e.parentElement)return{width:-1};if(-1==(c=t(e.parentElement,r)))return{width:-1,padding:0};n=c.width*n/100,"%"==o.slice(-1)&&(l=c.height*l/100)}else if(n<=1){if("IMG"===e.tagName&&void 0!==e.getAttribute("width")&&void 0!==e.getAttribute("height"))n=parseInt(e.getAttribute("width")),l=parseInt(e.getAttribute("height"));else{if(void 0===e.parentElement)return{width:-1,padding:0};var c;if(-1==(c=t(e.parentElement,r)).width)return{width:-1,padding:0};n=c.width,l=c.height}n-=i(a["margin-left"],n)+i(a["margin-right"],n),l-=i(a["margin-top"],l)+i(a["margin-bottom"],l)}var d=i(a["padding-left"],n)+i(a["padding-right"],n)+i(a["border-left-width"],n)+i(a["border-right-width"],n),h=i(a["padding-top"],l)+i(a["padding-bottom"],l)+i(a["border-top-width"],l)+i(a["border-bottom-width"],l);return{status:"success",width:n-d,height:l-h,padding:d,padding_height:h}}function i(e,t){return"%"==e.slice(-1)?t*parseFloat(e)/100:parseFloat(e)}let r,a,s=new class{constructor(){var e,t;if(this.serviceDomain="cdn.shortpixel.ai",this.serviceData={key:"undefined",quality:"lossy",convert:"auto",crop:!1,sizeBreakpoints:{on:!1},lqip:!0,rootMargin:"150px 0px 500px",network_optimizations:!1,doSelectors:[],exclusions:{},backgroundsMaxWidth:!1,resizeStyleBackgrounds:!0,safeLazyBackgrounds:!1,asyncInitialParsing:!1,backgroundReplaceClasses:[],backgroundLazySelectors:"",nativeLazyLoad:!1,sizeFromImageSuffix:!1,ignoreDpr:!1,debug:!1},this.inStyleCssBackgrounds={},this.pseudoSelRegex=/:?:(hover|focus(-visible|-within|)|active|after|before)\b/gm,this.processStylesheets=!1,"undefined"!=typeof spaiData&&spaiData===Object(spaiData)&&(this.serviceData=(e=this.serviceData,t=spaiData,Object.keys(t).forEach((function(i){e[i]=t[i]})),e)),void 0!==window.spaiDomain&&(this.serviceDomain=spaiDomain),spaiData.nativeLazyLoad)"loading"in document.createElement("img")||(this.serviceData.nativeLazyLoad=!1);else{let e=new RegExp("(googlebot/|Googlebot-Mobile|Googlebot-Image|Google favicon|Mediapartners-Google|bingbot|slurp|java|wget|curl|Commons-HttpClient|Python-urllib|libwww|httpunit|nutch|phpcrawl|msnbot|jyxobot|FAST-WebCrawler|FAST Enterprise Crawler|biglotron|teoma|convera|seekbot|gigablast|exabot|ngbot|ia_archiver|GingerCrawler|webmon |httrack|webcrawler|grub.org|UsineNouvelleCrawler|antibot|netresearchserver|speedy|fluffy|bibnum.bnf|findlink|msrbot|panscient|yacybot|AISearchBot|IOI|ips-agent|tagoobot|MJ12bot|dotbot|woriobot|yanga|buzzbot|mlbot|yandexbot|purebot|Linguee Bot|Voyager|CyberPatrol|voilabot|baiduspider|citeseerxbot|spbot|twengabot|postrank|turnitinbot|scribdbot|page2rss|sitebot|linkdex|Adidxbot|blekkobot|ezooms|dotbot|Mail.RU_Bot|discobot|heritrix|findthatfile|europarchive.org|NerdByNature.Bot|sistrix crawler|ahrefsbot|Aboundex|domaincrawler|wbsearchbot|summify|ccbot|edisterbot|seznambot|ec2linkfinder|gslfbot|aihitbot|intelium_bot|facebookexternalhit|yeti|RetrevoPageAnalyzer|lb-spider|sogou|lssbot|careerbot|wotbox|wocbot|ichiro|DuckDuckBot|lssrocketcrawler|drupact|webcompanycrawler|acoonbot|openindexspider|gnam gnam spider|web-archive-net.com.bot|backlinkcrawler|coccoc|integromedb|content crawler spider|toplistbot|seokicks-robot|it2media-domain-crawler|ip-web-crawler.com|siteexplorer.info|elisabot|proximic|changedetection|blexbot|arabot|WeSEE:Search|niki-bot|CrystalSemanticsBot|rogerbot|360Spider|psbot|InterfaxScanBot|Lipperhey SEO Service|CC Metadata Scaper|g00g1e.net|GrapeshotCrawler|urlappendbot|brainobot|fr-crawler|binlar|SimpleCrawler|Livelapbot|Twitterbot|cXensebot|smtbot|bnf.fr_bot|A6-Indexer|ADmantX|Facebot|Twitterbot|OrangeBot|memorybot|AdvBot|MegaIndex|SemanticScholarBot|ltx71|nerdybot|xovibot|BUbiNG|Qwantify|archive.org_bot|Applebot|TweetmemeBot|crawler4j|findxbot|SemrushBot|yoozBot|lipperhey|y!j-asr|Domain Re-Animator Bot|AddThis)","i"),t=navigator.userAgent;e.test(t)&&(this.serviceData.nativeLazyLoad=!0)}if("object"!=typeof this.serviceData.doSelectors)try{this.serviceData.doSelectors=JSON.parse(this.serviceData.doSelectors)}catch(e){this.serviceData.doSelectors="undefined"==typeof spai_doSelectors?[]:spai_doSelectors}if("object"!=typeof this.serviceData.exclusions)try{this.serviceData.exclusions=JSON.parse(this.serviceData.exclusions)}catch(e){this.serviceData.exclusions="undefined"==typeof spai_doSelectors?[]:spai_exclusions}if(0==this.serviceData.doSelectors.length){if(this.serviceData.doSelectors.push(this.newDoSelector({selectors:["img"],origAttr:"data-spai-src",targetAttr:"src"})),this.serviceData.backgroundReplaceClasses.length){let e=this.newDoSelector({selectors:["*"],type:"attr",targetAttr:"style",attrType:"style"}),t=this.newDoSelector({selectors:["*"],type:"attr",targetAttr:"style",attrType:"style",lazy:!1});for(let i=0;i<this.serviceData.backgroundReplaceClasses.length;i++){let r=this.serviceData.backgroundReplaceClasses[i];this.serviceData.backgroundLazySelectors.indexOf("."+r)>=0?e.filter.push({class:r}):t.filter.push({class:r})}e.filter.length&&this.serviceData.doSelectors.push(e),t.filter.length&&this.serviceData.doSelectors.push(t)}}else for(let e=0;e<this.serviceData.doSelectors.length;e++)this.serviceData.doSelectors[e]=this.newDoSelector(this.serviceData.doSelectors[e]);this.aTag=null;let i=navigator.connection||navigator.mozConnection||navigator.webkitConnection;this.connection=!!i&&i.effectiveType,this.pixelRatio=!1===this.serviceData.ignoreDpr&&window.devicePixelRatio>1?window.devicePixelRatio:1,this.serviceData.lqip&&"function"==typeof LQIP&&(this.lqipService=new LQIP)}_cdnKey(){return this.serviceData.key.toLowerCase()}_sortByKey(e){const t={};return Object.keys(e).sort().forEach((i=>{t[i]=e[i]})),t}newDoSelector(e){return{selectors:Array.isArray(e.selectors)&&e.selectors.length?e.selectors:["string"==typeof e.selectors?e.selectors:"*"],type:e.type?e.type:"attr",lazy:void 0===e.lazy||e.lazy,resize:void 0===e.resize||e.resize,origAttr:e.origAttr?e.origAttr:e.targetAttr,targetAttr:e.targetAttr,attrType:e.attrType?e.attrType:"url",filter:e.filter?e.filter:[],lqip:0}}prepareStyleSheets(e){this.processStylesheets=!0;let t=[],i=[];for(var r in e){var s=e[r];for(var n in s.styleSheets){var l=s.styleSheets[n];if(!0===l.spaiPrepared)continue;if(null==l.href)continue;let e=o.prepareScriptBlock(l,a,d,i);i=e.otherBgElems,t=t.concat(e.allBgRules),l.spaiPrepared=!0}}this.addUnmatchedCssBackgrounds(t),o.displayOtherBackgroundElements(Array.from(i),d),this.exclusionsPrepared()}exclusionsPrepared(){for(let e in this.serviceData.exclusions.selectors){0===this.serviceData.exclusions.selectors[e].cdn&&document.querySelectorAll(e).forEach((function(e){e.dataset.spaiBgPrepared="1"}))}}applySelectors(e){let t=this.serviceData.doSelectors.length;for(let a=0;a<t;a++){var i=this.serviceData.doSelectors[a];if("__stylesheet"==i.type){if(this.prepareStyleSheets([e]),"complete"!==document.readyState){var r=this;void 0===this.styleSheetsTargets&&(this.styleSheetsTargets=[]),this.styleSheetsTargets.indexOf(e)<0&&this.styleSheetsTargets.push(e),document.onreadystatechange=function(){"complete"===document.readyState&&r.prepareStyleSheets(r.styleSheetsTargets)}}}else{let t=[];for(let e=0;e<i.selectors.length;e++){let r=i.selectors[e];t=t.concat(this.splitSelectors(r))}let r="";for(let e=0;e<t.length;e++){let a=t[e],s="",o=i.origAttr?"["+i.origAttr+"]":"";for(let e=0;e<i.filter.length;e++){s+=a+((i.filter[e].class?"."+i.filter[e].class:"")+(i.filter[e].attrName?"["+i.filter[e].attrName+(i.filter[e].attrValue?'="'+i.filter[e].attrValue+'"':"")+"],":""))+o+","}s.length||(s=a+o+","),r+=s}r=r.slice(0,-1),o.applySelector(e,r,i)}}o.bulkLoadQueuedImages(),this.triggerEvent("spai-block-handled",e)}triggerEvent(e,t){const i=new Event(e,{bubbles:!0,cancelable:!0});t.dispatchEvent(i)}splitSelectors(e){if(0===e.indexOf("@"))return[e];for(var t=[],i=0,r=0,a="",s=0,o=e.length;s<o;s++){var n=e[s];if("("===n)i+=1;else if(")"===n)i-=1;else if("["===n)r+=1;else if("]"===n)r-=1;else if(","===n&&!i&&!r){t.push(a.trim()),a="";continue}a+=n}return t.push(a.trim()),t}addUnmatchedCssBackgrounds(e){for(var t="",i=0;i<e.length;i++){let a=e[i],s=!1;if(a.selectorText.match(this.pseudoSelRegex)){var r=this.replaceBackgroundPseudoSrcs(a.cssText,a.parentStyleSheet.href);r.replaced&&(t+=r.text,a.selectorText+",")}else s=!0;this.inStyleCssBackgrounds[a.selectorText]={css:a,lazy:s}}if(t.length){var a=document.createElement("style");a.setAttribute("type","text/css"),a.innerText=t,document.getElementsByTagName("head")[0].appendChild(a)}}getAbsoluteUrl(e){let[t,i]=e.split("://");return""!==i&&void 0!==i||(null===this.aTag&&(this.aTag=document.createElement("a")),this.aTag.href=e,e=this.aTag.href,[t,i]=e.split("://"),""!==i&&void 0!==i)?[t,e]:[!1,e]}updateImages(e){let t=document.getElementsByTagName("img");for(let i=0;i<t.length;i++)e.lazyLoadImage(t[i],!0,!1)}requiresBetterQuality(e){return void 0===e.dataset.spaiWidth||void 0===e.dataset.spaiOptimizedHeight||(parseInt(e.dataset.spaiWidth)<parseInt(e.clientWidth)||parseInt(e.dataset.spaiHeight)<parseInt(e.clientHeight))}parsePseudoSrc(e){if(e.indexOf("data:image/svg+xml")>=0)return this.parseInlinePseudoSrc(e);if(e.indexOf("data:image/")>=0)return{src:!1,origWidth:!1,origHeight:!1};let t=!1,i=!1;var[r,e]=this.getAbsoluteUrl(e);if("http"===r||"https"===r){if(e.includes(this.serviceDomain)){if(void 0===e.split("/")[4])throw"malformmed CDN URL: "+e;{let i=/(?:^|[,\/\+])w_([0-9.]+)([,\/\+]|$)/.exec(e);i&&void 0!==i[1]&&(t=parseInt(i[1]));let r=/(?:^|[,\/\+])h_([0-9.]+)([,\/\+]|$)/.exec(e);r&&void 0!==r[1]&&(t=parseInt(r[1]))}}if(!1===t&&this.serviceData.sizeFromImageSuffix){let r=this.getSizesFromSuffix(e);t=!!r.width&&parseInt(r.width),i=!!r.height&&parseInt(r.height)}}return{src:e,origWidth:t,origHeight:i}}getSizesFromSuffix(e){let t=/-([0-9]+)x([0-9]+)\.(jpe?g|png|gif)(\?|$)/i.exec(e);return null===t?{width:!1,height:!1}:{width:parseInt(t[1]),height:parseInt(t[2])}}urldecode(e){return decodeURIComponent((e+"").replace(/\+/g,"%20"))}parseInlinePseudoSrc(e){let t=e,i=!1,r=!1,a=!1,s=/([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$/;var o,n,l,c=!1;t=t.trim();try{if("string"==typeof t&&"string"==typeof(l=(l=t.match(s)).length>0?l[0]:void 0)&&(n=atob(l)),"string"==typeof n){a=n.indexOf("feGaussianBlur")>=0;var d=document.createElement("div");if(d.innerHTML=n,null===(o=d.firstChild)||1!==o.nodeType)throw new Error("Not our encoded SVG")}}catch(e){return this.serviceData.debug&&console.log("svgDecoded: "+n+" error: "+e.message),{src:!1,originalWidth:!1,originalHeight:!1}}if(null!==o.getAttribute("data-u")){var h={url:o.getAttribute("data-u"),width:o.getAttribute("data-w"),height:o.getAttribute("data-h")};""!==(c=void 0!==h.url&&""!==h.url&&this.urldecode(h.url))&&"string"==typeof c&&0===c.lastIndexOf("//",0)&&(c=window.location.protocol+c),!a&&c&&"object"==typeof this.lqipService&&this.lqipService.add(c,c),i=void 0!==h.width&&""!==h.width&&h.width,r=void 0!==h.height&&""!==h.height&&h.height}return{src:c,originalWidth:i,originalHeight:r,lqip:a}}spaiUrl(e,t){let i=this.getUrlData(e,t);return i.src?(i.originalWidth&&!t.originalWidth&&(t.originalWidth=i.originalWidth,t.originalHeight=i.originalHeight),!!i.src&&this.getImageCDNUrl(i.src,t)):e}replaceBackgroundPseudoSrcs(e,t){var i=!1,r=this;return e.replace(/background(-image|)\s*:([^;]*[,\s]|\s*)url\(['"]?([^'"\)]*?)(['"]?)\)/gm,(function(a){var s=/background(-image|)\s*:([^;]*[,\s]|\s*)url\(['"]?([^'"\)]*?)(['"]?)\)/m.exec(a)[3],o=s;if(t&&o.indexOf("://")<0&&(t.includes(r.serviceDomain)&&(t=(t.includes("/https://")?"https://":"http://")+t.split(/https?:\/\//).pop()),o=new URL(o,t).href),!ShortPixelAI.matchExclusions(!1,o).cdn)return{text:e,replaced:!1};window.screen.width,r.serviceData.backgroundsMaxWidth&&r.serviceData.backgroundsMaxWidth;var n=r.spaiUrl(o,{});n&&(e=e.replace(s,n),i=!0)})),{text:e,replaced:i}}getUrlData(e,t={}){let i={};if(0===e.indexOf("data:image/svg+xml;base64"))i=this.parseInlinePseudoSrc(e);else{if(0===e.indexOf("data:image/"))return{src:!1,lqip:!1,originalWidth:!1,originalHeight:!1};if(e.includes(this.serviceDomain)&&(i=this.getSpaiUrlData(e)),!i.src){var[r,a]=this.getAbsoluteUrl(e);i.src=a,i.originalWidth=i.originalHeight=!1}if(t.originalWidth)i.originalWidth=t.originalWidth,i.originalHeight=t.originalHeight;else if(this.serviceData.sizeFromImageSuffix){var s=this.getSizesFromSuffix(i.src);s.width&&(i.originalWidth=s.width,i.fromSuffix=!0),s.height&&(i.originalHeight=s.height)}!i.originalWidth&&i.lqip&&i.width&&(i.originalWidth=i.width,i.originalHeight=i.height)}return i}getSpaiUrlData(e){let t={src:!1,width:!1,height:!1,lqip:!1},i=e.split("/");if(void 0!==i[5]&&i[2]==this.serviceDomain){t.src=i.slice(5).join("/"),0!==t.src.indexOf("http")&&(t.src=(i[4].indexOf("p_h")>=0?"http://":"https://")+t.src),t.lqip=i[4].indexOf("q_lqip")>=0;let e=i[4].split("+");for(let i in e){let r=e[i];0===r.indexOf("w_")&&(t.width=parseInt(r.slice(2))),0===r.indexOf("h_")&&(t.height=parseInt(r.slice(2)))}}return t}getImageCDNUrl(e,t){let i=t.quality?t.quality:this.serviceData.quality,r=["q_"+this.qualityForConnection(i.toString())];if(e.match(/\.svg($|\?)/));else if(void 0!==t.clip&&(t.clip.width<t.originalWidth||t.clip.height<t.originalHeight))r.push("sc_"+this.sizeSafe(t.clip.offsetX,0)+"x"+this.sizeSafe(t.clip.offsetY,0)+":"+this.sizeSafe(t.clip.width)+"x"+this.sizeSafe(t.clip.height)+":"+this.sizeForConnection(t.viewport.width)+"x"+this.sizeForConnection(t.viewport.height));else if("lqip"==t.quality||void 0===t.originalWidth||t.originalWidth>t.width){let e=this.sizeForConnection("lqip"==t.quality?t.originalWidth:t.width,!1);if(e){let i=e;this.serviceData.sizeBreakpoints.on&&(i=this.getSizeBreakpoint(e,this.serviceData.sizeBreakpoints.base,1+this.serviceData.sizeBreakpoints.rate/100));let a=this.sizeForConnection("lqip"==t.quality?t.originalHeight:t.height,!1);r.push("w_"+i.toString()),a&&("lqip"==t.quality||(this.serviceData.crop||!0===t.crop)&&!1!==t.crop)&&(a=Math.round(a*i/e),r.push("h_"+a.toString()))}}if("none"!==this.serviceData.convert&&"lqip"!==t.quality){let t=this.serviceData.convert;if("object"==typeof this.serviceData.converts){let i=e.split(/[#?]/)[0].split(".").pop().trim();if(void 0!==this.serviceData.converts[i]){let e=this.serviceData.converts[i];"detect"!==e&&(t=e)}}"none"!==t&&r.push("to_"+t)}r.push("ret_img");var a=this.getAbsoluteUrl(e)[1];return 0===a.indexOf("http:")&&r.push("p_h"),a=a.replace(/http[s]?:\/\//,""),`https://${this.serviceDomain}/${this._cdnKey()}/`+r.join("+")+"/"+a}getSizeBreakpoint(e,t,i){if(e<=t)return t;let r=Math.floor(Math.log(e/t)/Math.log(i));return e<=Math.ceil(t*Math.pow(i,r))?Math.ceil(e):Math.ceil(t*Math.pow(i,r+1))}getMatchedSelector(e){for(let t=0;t<this.serviceData.doSelectors.length;t++){let i=this.serviceData.doSelectors[t];for(let t=0;t<i.selectors.length;t++){let r=i.selectors[t];if(("attr"!==i.type||e.getAttribute(i.targetAttr))&&e.matches(r)){if(!i.filter.length)return i;for(let t=0;t<i.filter.length;t++){let r=i.filter[t],a=!r.class||e.classList.contains(r.class),s=!r.attrName||e.getAttribute(r.attrName)&&(!r.attrVal||e.getAttribute(r.attrName)===r.attrVal);if(a&&s)return i}}}}return null}sizeSafe(e,t="auto"){if(null===e||"undefined"===e||"0"===e||0===e||isNaN(e))return t;let i=Math.round(e);return i>1?i:t}qualityForConnection(e){if(!0!==this.network_optimizations)return e;let t;return this.connection,t=e,t}sizeForConnection(e,t="auto"){if(!0!==this.network_optimizations)return this.sizeSafe(e*this.pixelRatio,t);switch(this.connection){case"3g":case"2g":case"slow-2g":return this.sizeSafe(e,t);default:return this.sizeSafe(e*this.pixelRatio,t)}}},o=window.ShortPixelAI=new class{constructor(e=null){this.replacerService=e,this.bgRegex=/(background-image|background)\s*:[^;}]*[;}]/gm,this.urlBgRegex=/((url)|\s*(var))\s*\(['"]?([^'"\)]*?)(['"]?)\)/gm,this.blank1px="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",this.urlRegister={},this.otherBackgroundSelectors={},this.bulkLoadingQueue=[]}isVisible(e){var t=e.getClientRects();return!!(e.offsetWidth||e.offsetHeight||t.length&&t[0].width&&t[0].height)}elementInViewport(e){if(!(e.offsetWidth||e.offsetHeight||e.getClientRects().length))return!1;var t=e.getBoundingClientRect(),i=Array.from(this.replacerService.serviceData.rootMargin.matchAll(/([0-9\.]+)px|(0)/g),(e=>parseFloat(e[1]||e[2])));return 1==i.length&&i.push(i[0]),t.bottom+(i.length>=3?i[2]:i[0])>=0&&t.right+i[1]>=0&&t.top-i[0]<=(window.innerHeight||document.documentElement.clientHeight)&&t.left-(i.length>=4?i[4]:i[1])<=(window.innerWidth||document.documentElement.clientWidth)}getSizesRecursive(e,t){if(!this.isVisible(e)&&t)throw{type:"defer",cause:"invisible"};var r=window.getComputedStyle(e),a=r.width,s=r.height,o=parseFloat(a),n=parseFloat(s);if("0px"==a&&"A"!==e.nodeName)throw{type:"defer",cause:"width 0"};if("%"==a.slice(-1)){if(void 0===e.parentElement)return{width:-1};if(-1==(l=this.getSizesRecursive(e.parentElement,t)))return{width:-1,padding:0};o=l.width*o/100,"%"==s.slice(-1)&&(n=l.height*n/100)}else if(o<=1){if(void 0===e.parentElement)return{width:-1,padding:0};var l;if(-1==(l=this.getSizesRecursive(e.parentElement,t)).width)return{width:-1,padding:0};o=l.width-l.padding-i(r["margin-left"],o)-i(r["margin-right"],o),n=l.height-l.padding_height-i(r["margin-top"],n)-i(r["margin-bottom"],n)}return{status:"success",width:o,height:n,padding:i(r["padding-left"],o)+i(r["padding-right"],o)+i(r["border-left-width"],o)+i(r["border-right-width"],o),padding_height:i(r["padding-top"],n)+i(r["padding-bottom"],n)+i(r["border-top-width"],n)+i(r["border-bottom-width"],n)}}requiresBetterQuality(e){return null===this.replacerService||"undefined"===this.replacerService||this.replacerService.requiresBetterQuality(e)}getImageSrc(e,t,i={}){let r=this.blank1px;return null!==this.replacerService&&"undefined"!==this.replacerService?this.replacerService.getImageCDNUrl(t,i):"undefined"!==args&&"undefined"!==args.quality&&"lqip"===args.quality?{url:r,size:i}:{url:t,size:i}}prepareImage(e,t){let i,r=e.target,a=this.replacerService,s=e.meta;if(r.dataset.spaiExcluded)return;if(r.dataset.spaiTarget&&(i=r.dataset.spaiTarget.split("|").indexOf(s.targetAttr))>=0)return void(r.dataset.spaiExclude&&"nocdn"!==r.dataset.spaiExclude.split("|")[i]&&t.addToObserver("SOURCE"==r.tagName?r.parentElement:r));let o,n=!!s.origAttr&&0===s.origAttr.indexOf("data-")&&s.origAttr!==s.targetAttr,l=n?s.origAttr.substring(5).replace(/-([a-z])/g,(function(e){return e[1].toUpperCase()})):s.origAttr,c={quality:"lqip"},d=!1;if(n&&r.dataset[l])o=r.dataset[l];else if(n&&r.dataset.spaiOrig&&r.dataset.spaiTarget&&r.dataset.spaiTarget.indexOf(l)>=0){let e=r.dataset.spaiTarget.split("|");o=r.dataset.spaiOrig.split("|")[e.indexOf(l)]}else(d=r.getAttribute(s.targetAttr))&&(d.indexOf("data:image/svg+xml;base64")>=0?(c=Object.assign(c,a.parseInlinePseudoSrc(r.getAttribute(s.targetAttr))),o=c.src):d.indexOf("https://"+this.replacerService.serviceDomain)<0&&/\.(jpe?g|png|gif)(\?|$)/i.exec(d)&&(o=d));if(o||"true"!=r.dataset.spaiLazyLoaded)if(r.dataset.spaiTarget=(r.dataset.spaiTarget?r.dataset.spaiTarget+"|":"")+s.targetAttr,r.dataset.spaiOrig=(r.dataset.spaiOrig?r.dataset.spaiOrig+"|":"")+(void 0!==o?o:""),o){let e=this.matchExclusions(r,o);if(s.lazy||(e.lazy=!1),s.resize&&e.resize&&(void 0===this.urlRegister[o]&&(this.urlRegister[o]=[]),this.urlRegister[o].push({target:r})),a.serviceData.lqip&&!a.serviceData.nativeLazyLoad&&-1!==e.lqip&&e.lazy){let e=c.originalWidth?c:a.getUrlData(o,c);e.lqip||e&&e.src&&(c.originalWidth=e.originalWidth,c.originalHeight=e.originalHeight,r.setAttribute(s.targetAttr,a.getImageCDNUrl(e.src,c)))}r.dataset.spaiExclude=(r.dataset.spaiExclude?r.dataset.spaiExclude+"|":"")+(e.cdn?s.resize&&e.resize?"none":"noresize":"nocdn"),!e.lazy||"src"===s.targetAttr&&a.serviceData.nativeLazyLoad?(e.lazy&&"src"===s.targetAttr&&a.serviceData.nativeLazyLoad&&(r.dataset.spaiLoading="lazy"),this.lazyLoadImage(r,!1,!0)):(t.addToObserver("SOURCE"==r.tagName?r.parentElement:r),r.dataset.spaiOrigObs=!0)}else this.isVisible(r)&&(r.dataset.spaiExclude=(r.dataset.spaiExclude?r.dataset.spaiExclude+"|":"")+"nocdn")}getApiUrl(){let e=this.replacerService.serviceData;return"https://"+this.replacerService.serviceDomain+"/"+e.key+"/w_%WIDTH%+q_"+e.quality+"+ret_img"}getAjaxUrl(){return spai_settings?spai_settings.ajax_url:"/wp-admin/admin-ajax.php"}matchExclusions(e,t){let i={lazy:1,cdn:1,lqip:0,resize:1,crop:0,url:!1},r=this.replacerService.serviceData.exclusions;if(r){if(e&&r.selectors)for(let t in r.selectors)try{if(e.matches(t)){let e=r.selectors[t];for(var a in e)i[a]=e[a];break}}catch(e){this.replacerService.serviceData.debug&&console.log("invalid selector: "+t+" ("+e.message+")")}if(t&&r.urls){let e=!1;if(r.urls[t])e=t;else{let i=!1,a=t;if(this.replacerService.serviceData.sizeFromImageSuffix){let e=t.match(/^(.+)-\d+x\d+(\..+)$/);a=e?e[1]+e[2]:t}for(e in r.urls){let r=e.split(":").splice(1).join(":");if(e.indexOf("path:")>=0&&(t.indexOf(r)>=0||a.indexOf(r)>=0)){i=!0;break}if(e.indexOf("domain:")>=0&&0==t.indexOf("http")&&t.split("/")[2].indexOf(r)>=0){i=!0;break}if(e.indexOf("regex:")>=0&&new RegExp(r.replace(/^\//,"").replace(/\/$/,"")).exec(t)){i=!0;break}}i||(e=!1)}if(e){let t=r.urls[e];for(var a in t)i[a]=t[a];i.url=!0}}}return 0==i.lazy&&(i.lqip=-1),0==i.cdn&&(i.resize=0),i}mergeExclusions(e,t){return{lazy:e.lazy&&t.lazy?1:0,cdn:e.cdn&&t.cdn?1:0,lqip:-1==e.lqip||-1==t.lqip?-1:e.lqip&&t.lqip?1:0,resize:e.resize&&t.resize?1:0,url:e.url||t.url}}prepareBkImage(e,t,i){let r=e.target,a=e.meta;if(r.dataset.spaiOrigObs)return;let s=this.replacerService,o=r.style.backgroundImage;if(o){let e=!1,n=!1,l=!0,c=[],d=!1,h=this.matchExclusions(r,!1),g=!h.cdn&&!h.lazy,p="none",u=this.elementInViewport(r);if(o.indexOf("q_lqip+")<0)if(-1!=h.lqip&&s.serviceData.lqip&&-1!=a.lqip||1==a.lqip||g){let t=this;o.replace(/url\(['"]?([^'"\)]*?)(['"]?)\)/gm,(function(i){var r=/url\(['"]?([^'"\)]*?)(['"]?)\)/m.exec(i),a=s.getUrlData(r[1]);if(a.src){p=h.cdn>0?h.resize?"none":"noresize":"nocdn";var o=t.matchExclusions(!1,a.src);o.url&&(p=o.cdn>0?o.resize?"none":"noresize":"nocdn");let i=!1;"nocdn"==p?a.src!==r[1]&&(i=a.src):(a.lqip<=0&&(i=s.spaiUrl(a.src,{quality:"lqip",originalWidth:a.originalWidth,originalHeight:a.originalHeight})),e=!0),n=!0,i&&c.push({url:i,match:r[1]})}})),d=function(){r.dataset.spaiExclude=p;for(let e in c)r.style.backgroundImage=r.style.backgroundImage.replace(c[e].match,c[e].url)}}else n=!0,l=!1,d=function(){r.dataset.spaiExclude=p},e=!0;else n=!0,e=!0;n&&this.bgPrepared(r,i,l,d),e&&(u||g?this.lazyLoadImageBackground(r):t.addToObserver(r))}}bgPrepared(e,t,i=!0,r=!1){t.ignoreMutations(),"function"==typeof r&&r(),i&&(e.dataset.spaiBgPrepared=1),e.dataset.spaiOrigObs=!0,t.resume()}prependClass(e,t){e.setAttribute(t,1)}prepareScriptBlock(e,t,i,r){var a=this.getScriptBlockSelectors(e),s=a.imageBgs,o=[];for(var n in s)try{if((p=document.querySelectorAll(s[n].selectorString)).length){var l=s[n].selectors;if("var"===s[n].type){for(var c=0;c<p.length;c++){let e=p[c],t=e.getAttribute("style"),r=new RegExp(n+"\\s*:([^;]*[,\\s]|\\s*)(url|var)\\s*\\(['\"]?([^'\"\\)]*?)([\\'\"]?)\\)").exec(t);if(r&&r.length>=4&&r[3].length){let a=this.replacerService.spaiUrl(r[3],{originalWidth:!1,originalHeight:!1});i.ignoreMutations(),e.setAttribute("style",t.replace(r[3],a))}}continue}var d=0===n.indexOf("\\/")||null!==/https?\\:/.exec(n)?n.replace(/\\([:\/\.\?\=\&])/g,"$1"):n;e.href&&!/^(\/|https?:\/\/)/.test(d)&&(d=new URL(d,e.href).toString());var h=this.replacerService.getUrlData(d);if(h.src){let e=l[0].style.backgroundImage,a=e,s=!1,o="",g=this.matchExclusions(!1,h.src),u=g.cdn&&g.lqip>=0&&this.replacerService.serviceData.lqip;u?(o="important",h.lqip?a=e:(s=this.replacerService.getImageCDNUrl(h.src,{quality:"lqip",originalWidth:h.originalWidth,originalHeight:h.originalHeight}),a=e.replace(n,s))):d!==n&&(null==/url\s*\(\s*["']/.exec(e)&&(d='"'+d+'"'),a=e.replace(n,d));for(c=0;c<p.length;c++){let s=p[c];if(s.dataset.spaiBgLazyloaded)continue;let n=this.mergeExclusions(this.matchExclusions(s,!1),g),l=!n.cdn||!n.lazy,d=u&&g.cdn&&g.lqip>=0,f=d||!u?a:e,v=d||l?o:"",m=n.cdn?n.resize?"none":"noresize":"nocdn";h.lqip&&s.style.backgroundImage||(i.ignoreMutations(),l||(s.style.setProperty("background-image",f,v),s.dataset.spaiExclude=m),v.length||l?s.dataset.spaiBgPrepared=1:s.dataset.spaiBgOn=1),l||(this.elementInViewport(s)||!n.lazy?this.lazyLoadImageBackground(s):t.addToObserver(s));let b=r.indexOf(s);-1!==b&&r.splice(b,1)}}else for(c=0;c<p.length;c++){let e=p[c];i.ignoreMutations(),e.dataset.spaiBgPrepared=1}}o=o.concat(s[n].selectors)}catch(e){this.replacerService.serviceData.debug&&console.log(e.message)}var g=a.otherBgs;for(var n in g)try{this.otherBackgroundSelectors[n]=!0;var p=document.querySelectorAll(n);for(c=0;c<p.length;c++)r.push(p[c])}catch(e){this.replacerService.serviceData.debug&&console.log("Malformed CSS selector: "+n+" ("+e.message+")")}return i.resume(),{allBgRules:o,otherBgElems:r}}prepareScriptBlockAndOther(e,t,i){let r=this.prepareScriptBlock(e,t,i,[]);this.displayOtherBackgroundElements(r.otherBgElems,i)}displayOtherBackgroundElements(e,t){if(e.length){for(var i in t.ignoreMutations(),e){e[i].dataset.spaiBgPrepared=1}t.resume()}}matchesOtherBackgroundSelectors(e){for(let t in this.otherBackgroundSelectors)if(e.matches(t))return!0;return!1}getScriptBlockSelectors(e){try{var t=e.cssRules}catch(a){return this.replacerService.serviceData.debug&&console.log("Probably CORS issue reading from "+e.href+": "+a.message),{imageBgs:{},otherBgs:{}}}for(var i={},r={},a=0;a<t.length;a++){var s;this.bgRegex.lastIndex=0;var o=t[a];if(o instanceof CSSMediaRule){if(window.matchMedia(o.conditionText).matches){var n=this.getScriptBlockSelectors(o);Object.assign(i,n.imageBgs),Object.assign(r,n.otherBgs)}}else if(o instanceof CSSImportRule){var l=this.getScriptBlockSelectors(o.styleSheet);Object.assign(i,l.imageBgs),Object.assign(r,l.otherBgs)}else if(o instanceof CSSStyleRule){var c=o.cssText||o.style.cssText;if(this.bgRegex.exec(c)){let e=!1,t=o.selectorText;for(t=t||!1,this.urlBgRegex.lastIndex=0;null!==(s=this.urlBgRegex.exec(c))&&s&&!(s.length<4);)if(0!=s[5].length){var d=s[4],h="",g=s[2]||s[3];(d.indexOf("data:image/")<0||0===d.indexOf("data:image/svg+xml;base64")&&this.replacerService.parseInlinePseudoSrc(d))&&(i[d]?h=", ":i[d]={selectors:[],selectorString:""},i[d].type=g,i[d].selectorString=i[d].selectorString+h+t,i[d].selectors.push(o),e=!0)}if(!e&&t&&/background(-image|)\s*:[^;]*(url|var|-gradient|rgba?)\s*\(/.exec(c)){r[t.replaceAll(this.replacerService.pseudoSelRegex,"")]=!0}}}}return{imageBgs:i,otherBgs:r}}skipLazyLoad(e){let t=e.target;if(t.dataset.spaiOrig&&t.dataset.spaiTarget&&t.dataset.spaiTarget.indexOf("src")){let e=t.dataset.spaiTarget.split("|"),r=t.dataset.spaiOrig.split("|")[e.indexOf("src")],a=this.getImageSrc(t,r,t.src?function(e){var t=getComputedStyle(e);let r=e.clientWidth,a=e.attributes.width?e.attributes.width.value:"auto",s=e.attributes.height?e.attributes.height.value:"auto",o="auto"===a||"auto"===s||"100%"===a||"100%"===s?e.clientHeight:parseInt(s/a*r);r=parseInt(r),o=parseInt(o);let n=r-i(t["padding-left"],r)-i(t["padding-right"],r),l="auto";return isNaN(o)||(l=o-i(t["padding-top"],o)-i(t["padding-bottom"],o)),{width:n>0?n:"auto",height:l>0?l:"auto"}}(t):{});t.src=a.url,t.dataset.spaiLazyLoaded="true"}}getMaxSize4URL(e,i){let r={width:!1,height:!1},a=null;for(let r=0;r<this.urlRegister[e].length;r++){if(a=this.urlRegister[e][r],a.target===i){void 0===a.size&&(a.size=t(a.target,!1));break}a=null}for(let i=0;i<this.urlRegister[e].length;i++){let s=this.urlRegister[e][i];void 0===s.size&&(s.size=t(s.target,!1)),(!r.width||r.width<s.size.width&&Math.abs(a.size.width*s.size.height/a.size.height/s.size.width-1)<.01)&&(r=s.size)}return r.crop=void 0!==i.dataset.spaiCrop?"true"===i.dataset.spaiCrop:this.replacerService.serviceData.crop,r}queueForBulkLoading(e,t,i,r){this.bulkLoadingQueue.push({image:e,targetAttr:t,optSrc:i,imgElmSize:r})}bulkLoadQueuedImages(){for(;this.bulkLoadingQueue.length;){let e=this.bulkLoadingQueue.shift();this.doLazyLoadImageAttr(e.image,e.targetAttr,e.optSrc,e.imgElmSize)}}lazyLoadImage(e,t,i){let r=e.dataset.spaiTarget?e.dataset.spaiTarget.split("|"):[!1],a=e.dataset.spaiOrig?e.dataset.spaiOrig.split("|"):[!1],s=e.dataset.spaiExclude?e.dataset.spaiExclude.split("|"):[!1];for(let o=0;o<r.length;o++)this.lazyLoadImageAttr(e,t,i,r[o],a[o],s[o])}lazyLoadImageAttr(e,t,i,r,a,s){let o=r,n=!!r&&(!!e.getAttribute(r)&&e.getAttribute(r));if(a&&this.requiresBetterQuality(e)||n&&(n.includes("data:image/svg+xml")||n.includes(this.replacerService.serviceDomain)&&n.includes("q_lqip"))&&"true"!==e.dataset.spaiLazyLoaded){let r=!0,l=!0;if("none"!==s)r="nocdn"!==s,l=r&&"noresize"!==s;else{let t=this.matchExclusions(e,!1);r=t.cdn,l=t.resize}let c={width:!1,height:!1},h=a||n;if(l)try{c=this.getMaxSize4URL(h,e)}catch(i){if(void 0!==i.type&&"defer"==i.type&&t)return d.ignoreMutations(),this.removeTarget(e,o),e.dataset.spaiDeferred=(e.dataset.spaiDeferred?parseInt(e.dataset.spaiDeferred)+1:1).toString(),void d.resume()}let g=r?this.replacerService.spaiUrl(h,c):this.replacerService.getUrlData(h).src;if(!g||e.getAttribute(o)===g)return;i?this.queueForBulkLoading(e,o,g,c):this.doLazyLoadImageAttr(e,o,g,c)}}doLazyLoadImageAttr(e,t,i,r){let a=this,o=function(){d.ignoreMutations(),e.setAttribute(t,i),e.dataset.spaiLazyLoaded="true",e.dataset.spaiWidth=`${r.width}`,e.dataset.spaiHeight=`${r.height}`,"lazy"===e.dataset.spaiLoading&&e.setAttribute("loading","lazy"),a.removeTarget(e,t),d.resume(),s.triggerEvent("spai-element-handled",e)};this.replacerService.serviceData.lqip&&"lazy"!==e.dataset.spaiLoading?this.onImageLoad(i,o):o()}removeTarget(e,t){if(e.dataset.spaiTarget){let i=e.dataset.spaiTarget.split("|"),r=i.indexOf(t);if(r>=0)if(i.splice(r,1),0===i.length)delete e.dataset.spaiTarget,delete e.dataset.spaiOrig,delete e.dataset.spaiExclude;else{e.dataset.spaiTarget=i.join("|");let t=e.dataset.spaiOrig.split("|");t.splice(r,1),e.dataset.spaiOrig=t.join("|");let a=e.dataset.spaiExclude.split("|");a.splice(r,1),e.dataset.spaiExclude=a.join("|")}}}lazyLoadImageBackground(e){let t=spaiCalculateBgClipResize(e,this.replacerService,!e.dataset.spaiExclude||"none"==e.dataset.spaiExclude,this.replacerService.serviceData.resizeStyleBackgrounds);for(const i in t){if(0==i.indexOf("https://"+this.replacerService.serviceDomain)&&i.indexOf("q_lqip+")<0)continue;let r=t[i];r.crop=void 0!==typeof e.dataset.spaiCrop?e.dataset.spaiCrop:this.replacerService.serviceData.crop,r.quality="lossy","undefined"!==this.replacerService.serviceData.quality&&(r.quality=this.replacerService.serviceData.quality),r.quality=this.replacerService.qualityForConnection(r.quality);let a=e.style.backgroundImage;if(!a){a=getComputedStyle(e).backgroundImage}if(a){let t=this.replacerService,i=a,o=this;a.replace(/url\(['"]?([^'"\)]*?)(['"]?)\)/gm,(function(a){let n=/url\(['"]?([^'"\)]*?)(['"]?)\)/m.exec(a)[1],l="nocdn"==e.dataset.spaiExclude?r.originalUrl:t.spaiUrl(n,r);o.onImageLoad(l,(function(t){if(i=i.replace(n,l),d.ignoreMutations(),e.style.setProperty("background-image",i,"important"),e.dataset.spaiLazyLoaded="true",e.dataset.spaiBgPrepared||(e.dataset.spaiBgPrepared=1),e.dataset.spaiBgLazyloaded=1,r.alterCss&&t.width==r.viewport.width&&t.height==r.viewport.height)for(const t in r.alterCss)e.style[t]=r.alterCss[t];d.resume(),s.triggerEvent("spai-element-handled",e)}))}))}}}applySelector(e,t,i){let s=e.querySelectorAll(t);"function"==typeof e.matches&&e.matches(t)&&(s=Array.from(s),s.unshift(e));for(let e=0;e<s.length;e++){let t=s[e];t.dataset.spaiBgLazyloaded||("attr"==i.type?"url"==i.attrType?this.prepareImage({target:t,meta:i},r):"style"==i.attrType?this.prepareBkImage({target:t,meta:i},a,d):i.attrType:"style"==i.attrType&&"spai_bg_lazr"!==t.id&&this.prepareScriptBlockAndOther(t.sheet,a,d))}}onImageLoad(e,t){let i=new Image;i.onload=async function(){this.complete&&t(i)},this.replacerService.serviceData.debug&&(i.onerror=async function(){console.log("ERROR GETTING IMAGE: "+e)}),i.src=e}}(s),n=function(e,t){e.forEach((function(e){if(e.isIntersecting){if(function(){try{return window.self!==window.top}catch(e){return!0}}())return o.skipLazyLoad(e),void t.unobserve(e.target);o.lazyLoadImage(e.target,!0,!1),e.target.querySelectorAll("source").forEach((function(e){o.lazyLoadImage(e,!0,!1)})),t.unobserve(e.target)}}))},l=function(e,t){e.forEach((function(e){e.isIntersecting&&(e.target.dataset.spaiBgLazyloaded||o.lazyLoadImageBackground(e.target),t.unobserve(e.target))}))},c=function(e){let t;if(1===e.nodeType){if(o.bgRegex.lastIndex=0,o.bgRegex.exec(e.getAttribute("style"))&&(e.dataset.spaiBgOn=1),t=s.getMatchedSelector(e))if("attr"==t.type)"style"===t.attrType?o.prepareBkImage({target:e,meta:t},a,d):o.prepareImage({target:e,meta:t},r);else if("inner"==t.type&&"style"==t.attrType)o.prepareScriptBlockAndOther(e.sheet,a,d);else if("__stylesheet"===t.type)for(let t in s.inStyleCssBackgrounds)if(e.matches(t)){let i=s.inStyleCssBackgrounds[t];if(e.dataset.spaiBgPrepared=1,i.lazy){let t=getComputedStyle(e);t.backgroundImage.indexOf("data:image/svg+xml")&&(e.style.backgroundImage=t.backgroundImage,o.prepareBkImage({target:e,meta:{lqip:0}},a,d))}else e.dataset.spaiOrigObs=!0}e.dataset.spaiBgPrepared||!s.serviceData.safeLazyBackgrounds&&!o.matchesOtherBackgroundSelectors(e)||(e.dataset.spaiBgPrepared=1)}let i=e.childNodes;for(let e=0;e<i.length;e++)1===i[e].nodeType&&c(i[e])},d=new class{constructor(e){this.observer=new MutationObserver(e),this.observer.wrapper=this,this.observing=!1}init(){let e=document.getElementsByTagName("html")[0];this.addToObserver(e),this.observing=!0}addToObserver(e){this.observer.observe(e,{attributes:!0,childList:!0,subtree:!0})}ignoreMutations(){this.observing&&(this.observer.disconnect(),this.observing=!1)}resume(){this.observing||(this.init(),this.observing=!0)}}((function(e,t){if(!ShortPixelAI.sniperOn){for(let i of e){if("childList"===i.type)for(let e=0;e<i.addedNodes.length;e++){let t=i.addedNodes[e];c(t)}if("attributes"===i.type&&"data-spai-src-obs"!==i.attributeName){let e=i.target;"LINK"==e.nodeName?s.processStylesheets&&"rel"==i.attributeName.toLowerCase()&&"stylesheeet"==e.getAttribute(i.attributeName).toLowerCase()&&(i.target.onload=function(e){for(var t in target.styleSheets){var i=target.styleSheets[t];i.href.indexOf(e.target.getAttr)>=0&&o.prepareScriptBlockAndOther(i,a,d)}}):(t.wrapper.ignoreMutations(),s.applySelectors(e),e.dataset.spaiBgPrepared||!s.serviceData.safeLazyBackgrounds&&!o.matchesOtherBackgroundSelectors(e)||(e.dataset.spaiBgPrepared=1),t.wrapper.resume())}}o.bulkLoadQueuedImages()}})),h=function(){"loading"!==document.readyState?g():document.addEventListener("DOMContentLoaded",g)};function g(){let t;r=new e(n,o.replacerService.serviceData.rootMargin),a=new e(l,o.replacerService.serviceData.rootMargin),window.addEventListener("resize",(function(){clearTimeout(t),t=setTimeout((function(){let e=new Event("resize-end");window.dispatchEvent(e)}),500)}));let i=window.innerWidth;window.addEventListener("resize-end",(function(){let e=window.innerWidth;1.15*i<=e&&(s.updateImages(o),i=e)}));let c=function(){var e=o.replacerService;e.applySelectors(document),d.init(),e.triggerEvent("spai-body-handled",document.body)};s.serviceData.asyncInitialParsing?setTimeout(c,0):c()}"detect"===s.serviceData.convert&&"function"==typeof spaiHasNG&&self.createImageBitmap?spaiHasNG("avif").then((function(){s.serviceData.convert="avif",h()}),(function(){spaiHasNG("webp").then((function(){s.serviceData.convert="webp",h()}),(function(){s.serviceData.convert="none",h()}))})):h()}();
